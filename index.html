<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>M√©t√©o compl√®te Zimmersheim - am√©lior√©e</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body, html {
      margin: 0; padding: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(to bottom, #87ceeb, #f0f8ff);
      color: #222;
      overflow-x: hidden;
    }

    #background-anim {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      z-index: -1;
      pointer-events: none;
      overflow: hidden;
    }

    .cloud {
      position: absolute;
      background: linear-gradient(to bottom, #f0f4f8, #cbd6e8);
      border-radius: 50px;
      filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));
      animation: cloudMove linear infinite;
      opacity: 0.8;
    }

    .cloud::before, .cloud::after {
      content: '';
      position: absolute;
      background: inherit;
      border-radius: 50px;
    }
    .cloud::before { width: 60px; height: 60px; top: -30px; left: 10px; }
    .cloud::after { width: 50px; height: 50px; top: -20px; left: 45px; }

    @keyframes cloudMove {
      0% { left: -150px; }
      100% { left: 110vw; }
    }

    .rain {
      position: absolute;
      width: 2px; height: 15px;
      background: rgba(0, 150, 255, 0.5);
      border-radius: 50%;
      animation: rainFall linear infinite;
    }
    @keyframes rainFall {
      0% { top: -20px; opacity: 1; }
      100% { top: 110vh; opacity: 0; }
    }

    .snow {
      position: absolute;
      width: 8px; height: 8px;
      background: white;
      border-radius: 50%;
      filter: drop-shadow(0 0 1px #aaa);
      animation: snowFall linear infinite;
    }
    @keyframes snowFall {
      0% { top: -10px; opacity: 1; transform: translateX(0); }
      100% { top: 110vh; opacity: 0; transform: translateX(20px); }
    }

    #container {
      display: flex;
      max-width: 1200px;
      margin: 30px auto;
      gap: 20px;
      flex-wrap: wrap;
    }

    #left-panel {
      flex: 1 1 350px;
      background: rgba(255,255,255,0.9);
      border-radius: 15px;
      padding: 20px;
      box-shadow: 0 0 30px rgba(0,0,0,0.1);
      user-select: none;
    }

    #right-panel {
      flex: 1 1 600px;
      border-radius: 15px;
      overflow: hidden;
      box-shadow: 0 0 30px rgba(0,0,0,0.1);
    }

    #right-panel iframe {
      width: 100%; height: 300px; border: none;
    }

    h1, h2 {
      margin-bottom: 15px; user-select: none;
      text-align: center;
    }

    .info-row {
      margin: 10px 0;
      font-size: 1.1rem;
      display: flex; align-items: center; justify-content: space-between;
    }

    .label {
      font-weight: 700;
      color: #555;
    }

    #condition-icon {
      display: block;
      margin: 10px auto;
      width: 100px; height: 100px;
    }

    #wind-arrow {
      display: inline-block;
      width: 24px; height: 24px;
      margin-left: 8px;
      vertical-align: middle;
      transition: transform 0.3s ease;
    }

    section.chart-section {
      background: rgba(255,255,255,0.95);
      margin: 30px auto;
      max-width: 1200px;
      border-radius: 15px;
      padding: 20px;
      box-shadow: 0 0 30px rgba(0,0,0,0.08);
      user-select: none;
    }

    canvas {
      width: 100% !important;
      max-height: 400px !important;
    }

    /* Fond √©toil√© & lune */
    .stars {
      position: absolute;
      width: 100%; height: 100%;
      background: url('https://i.imgur.com/1K8r3Ls.png') repeat;
      opacity: 0.4;
    }
    .moon {
      position: absolute;
      top: 40px; right: 60px;
      width: 100px; height: 100px;
      background: radial-gradient(circle at 30% 30%, #fff, #ddd);
      border-radius: 50%;
      box-shadow: 0 0 40px #fff8;
    }
  </style>
</head>

<body>
  <div id="background-anim"></div>
  <div id="container">
    <div id="left-panel">
      <h1>M√©t√©o actuelle - Zimmersheim</h1>
      <img id="condition-icon" src="" alt="Ic√¥ne m√©t√©o" />
      <div class="info-row"><span class="label">Condition :</span> <span id="description"></span></div>
      <div class="info-row"><span class="label">Temp√©rature :</span> <span id="temp"></span> ¬∞C</div>
      <div class="info-row"><span class="label">Humidit√© :</span> <span id="humidity"></span> %</div>
      <div class="info-row"><span class="label">Pr√©cipitations :</span> <span id="precip"></span></div>
      <div class="info-row"><span class="label">Pression :</span> <span id="pressure"></span> hPa</div>
      <div class="info-row"><span class="label">Vent :</span> <span id="wind"></span> km/h
        <svg id="wind-arrow" viewBox="0 0 24 24" fill="none" stroke="#0077cc" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
          <line x1="12" y1="19" x2="12" y2="5"></line>
          <polyline points="5 12 12 5 19 12"></polyline>
        </svg>
      </div>
      <div class="info-row"><span class="label">Direction vent :</span> <span id="wind-dir"></span></div>
      <div class="info-row"><span class="label">Lever du soleil :</span> <span id="sunrise"></span></div>
      <div class="info-row"><span class="label">Coucher du soleil :</span> <span id="sunset"></span></div>
      <div class="info-row"><span class="label">Luminosit√© estim√©e :</span> <span id="luminosity"></span> %</div>
      <div class="info-row"><span class="label">Phase de lune :</span> <span id="moon-phase"></span></div>
      <div class="info-row"><span class="label">Qualit√© de l'air :</span> <span id="air-quality"></span></div>
      <div class="info-row"><span class="label">UV actuel :</span> <span id="uv"></span></div>
    </div>

    <div id="right-panel">
      <h2 style="text-align:center; padding: 10px 0;">Vue satellite - Zimmersheim</h2>
      <iframe id="map-frame" src="https://www.google.com/maps/embed?pb=!1m14!1m12!1m3!1d2777.8758572121094!2d7.3373!3d47.7745!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!5e0!3m2!1sfr!2sfr!4v1691246400000!5m2!1sfr!2sfr" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
    </div>
  </div>

  <section class="chart-section">
    <h2>üìä Graphique principal</h2>
    <canvas id="mainChart"></canvas>
  </section>

  <section class="chart-section">
    <h2>üìä Graphique secondaire (vent, UV, luminosit√©)</h2>
    <canvas id="windChart"></canvas>
  </section>

  <section class="chart-section">
    <h2>üìä Qualit√© de l'air d√©taill√©e</h2>
    <canvas id="airChart"></canvas>
  </section>

  <script>

const apiKey = "f59e1314a26b162f41dabbc7bb2b7719"; // Remplace par ta cl√© OpenWeatherMap
const city = "Zimmersheim,fr";
const units = "metric";
const lang = "fr";

const conditionIcon = document.getElementById('condition-icon');
const windArrow = document.getElementById('wind-arrow');
const windDirSpan = document.getElementById('wind-dir');
const luminositySpan = document.getElementById('luminosity');
const moonPhaseSpan = document.getElementById('moon-phase');
const airQualitySpan = document.getElementById('air-quality');
const uvSpan = document.getElementById('uv');

function degToCardinal(deg) {
  if (deg == null) return "N/A";
  const directions = ['N', 'NNE', 'NE', 'ENE', 'E', 'ESE', 'SE', 'SSE',
                      'S', 'SSO', 'SO', 'OSO', 'O', 'ONO', 'NO', 'NNO'];
  const index = Math.floor(((deg + 11.25) % 360) / 22.5);
  return directions[index];
}

function formatTime(unixTimestamp) {
  const d = new Date(unixTimestamp * 1000);
  return d.toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' });
}

function clearChildren(parent) {
  while (parent.firstChild) parent.removeChild(parent.firstChild);
}

function createClouds() {
  const container = document.getElementById('background-anim');
  clearChildren(container);
  for (let i=0; i<5; i++) {
    const cloud = document.createElement('div');
    cloud.className = 'cloud';
    cloud.style.top = (20 + i*50) + 'px';
    cloud.style.width = (80 + Math.random()*60) + 'px';
    cloud.style.height = '50px';
    cloud.style.animationDuration = (30 + Math.random()*40) + 's';
    cloud.style.animationDelay = (-Math.random()*60) + 's';
    container.appendChild(cloud);
  }
}

function createRain() {
  const container = document.getElementById('background-anim');
  clearChildren(container);
  for (let i=0; i<50; i++) {
    const drop = document.createElement('div');
    drop.className = 'rain';
    drop.style.left = (Math.random() * window.innerWidth) + 'px';
    drop.style.animationDuration = (0.5 + Math.random()*0.5) + 's';
    drop.style.animationDelay = (-Math.random()*1) + 's';
    container.appendChild(drop);
  }
}

function createSnow() {
  const container = document.getElementById('background-anim');
  clearChildren(container);
  for (let i=0; i<40; i++) {
    const flake = document.createElement('div');
    flake.className = 'snow';
    flake.style.left = (Math.random() * window.innerWidth) + 'px';
    flake.style.animationDuration = (3 + Math.random()*4) + 's';
    flake.style.animationDelay = (-Math.random()*7) + 's';
    container.appendChild(flake);
  }
}

function clearAnimations() {
  const container = document.getElementById('background-anim');
  clearChildren(container);
  // Ajouter √©toiles et lune fixes
  const stars = document.createElement('div');
  stars.className = 'stars';
  container.appendChild(stars);
  const moon = document.createElement('div');
  moon.className = 'moon';
  container.appendChild(moon);
}

// Calcul phase lunaire (0=new lune, 0.5=pleine lune)
function getMoonPhase(date) {
  // Source simplifi√©e: https://stackoverflow.com/questions/3227503/how-to-get-the-moon-phase
  const lp = 2551443; // Dur√©e lunaison en sec
  const new_moon = new Date(1970,0,7,20,35,0).getTime()/1000; // Date lune neuve fixe
  const now = date.getTime()/1000;
  const phase = ((now - new_moon) % lp) / lp;
  return phase;
}

function moonPhaseName(phase) {
  if (phase < 0.03 || phase > 0.97) return "Nouvelle Lune üåë";
  if (phase < 0.22) return "Premier Croissant üåí";
  if (phase < 0.28) return "Premier Quartier üåì";
  if (phase < 0.47) return "Lune Gibbeuse Croissante üåî";
  if (phase < 0.53) return "Pleine Lune üåï";
  if (phase < 0.72) return "Lune Gibbeuse D√©croissante üåñ";
  if (phase < 0.78) return "Dernier Quartier üåó";
  return "Dernier Croissant üåò";
}

async function fetchWeather() {
  try {
    // M√©t√©o actuelle
    const resCurrent = await fetch(`https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=${apiKey}&units=${units}&lang=${lang}`);
    const dataCurrent = await resCurrent.json();

    document.getElementById("description").textContent = dataCurrent.weather[0].description;
    document.getElementById("temp").textContent = Math.round(dataCurrent.main.temp);
    document.getElementById("humidity").textContent = dataCurrent.main.humidity;
    let precip = 0;
    if(dataCurrent.rain && dataCurrent.rain["1h"]) precip += dataCurrent.rain["1h"];
    if(dataCurrent.snow && dataCurrent.snow["1h"]) precip += dataCurrent.snow["1h"];
    document.getElementById("precip").textContent = precip > 0 ? precip.toFixed(1) + " mm" : "Aucune";
    document.getElementById("pressure").textContent = dataCurrent.main.pressure;
    document.getElementById("wind").textContent = Math.round(dataCurrent.wind.speed * 3.6);

    // Vent
    const deg = dataCurrent.wind.deg;
    const cardinal = degToCardinal(deg);
    windDirSpan.textContent = `${cardinal} (${deg}¬∞)`;
    windArrow.style.transform = `rotate(${deg}deg)`;

    document.getElementById("sunrise").textContent = formatTime(dataCurrent.sys.sunrise);
    document.getElementById("sunset").textContent = formatTime(dataCurrent.sys.sunset);

    conditionIcon.src = `https://openweathermap.org/img/wn/${dataCurrent.weather[0].icon}@4x.png`;
    conditionIcon.alt = dataCurrent.weather[0].description;

    // Luminosit√© brute estim√©e √† 100% si jour, 0% si nuit, corrig√©e par n√©bulosit√©
    const now = new Date();
    const sunrise = new Date(dataCurrent.sys.sunrise * 1000);
    const sunset = new Date(dataCurrent.sys.sunset * 1000);
    let baseLum = (now >= sunrise && now <= sunset) ? 100 : 0;
    // Pond√©ration n√©bulosit√© : + nuages = moins lumineux
    const clouds = dataCurrent.clouds ? dataCurrent.clouds.all : 0; // en %
    // On inverse : si nuages = 80% alors luminosit√© r√©duit de 80%
    const correctedLum = baseLum * (1 - clouds / 100);
    luminositySpan.textContent = Math.round(correctedLum);

    // Phase de lune
    const phase = getMoonPhase(now);
    moonPhaseSpan.textContent = moonPhaseName(phase);

    // Animation fond selon m√©t√©o
    const main = dataCurrent.weather[0].main.toLowerCase();
    if(main.includes("rain")) createRain();
    else if(main.includes("snow")) createSnow();
    else if(main.includes("cloud")) createClouds();
    else clearAnimations();

  } catch (e) {
    console.error("Erreur m√©t√©o actuelle :", e);
    alert("Erreur lors de la r√©cup√©ration de la m√©t√©o actuelle.");
  }
}

async function fetchForecastAndAir() {
  try {
    // Pr√©visions 5 jours (3h)
    const resForecast = await fetch(`https://api.openweathermap.org/data/2.5/forecast?q=${city}&appid=${apiKey}&units=${units}&lang=${lang}`);
    const dataForecast = await resForecast.json();

    // UV + Qualit√© de l'air
    // Coordonn√©es
    const lat = dataForecast.city.coord.lat;
    const lon = dataForecast.city.coord.lon;

    // UV (Index UV actuel)
    const resUV = await fetch(`https://api.openweathermap.org/data/2.5/uvi?appid=${apiKey}&lat=${lat}&lon=${lon}`);
    const dataUV = await resUV.json();

    uvSpan.textContent = dataUV.value;

    // Qualit√© de l'air (donn√©es actuelles)
    const resAir = await fetch(`https://api.openweathermap.org/data/2.5/air_pollution?lat=${lat}&lon=${lon}&appid=${apiKey}`);
    const dataAir = await resAir.json();

    if(dataAir.list && dataAir.list.length > 0) {
      const air = dataAir.list[0].components;
      airQualitySpan.textContent = `AQI: ${dataAir.list[0].main.aqi} (PM2.5: ${air.pm2_5} Œºg/m¬≥, PM10: ${air.pm10} Œºg/m¬≥, O3: ${air.o3} Œºg/m¬≥, NO2: ${air.no2} Œºg/m¬≥, SO2: ${air.so2} Œºg/m¬≥, CO: ${air.co} Œºg/m¬≥)`;
    } else {
      airQualitySpan.textContent = "Donn√©es indisponibles";
    }

    // Pr√©parer tableaux pour graphiques
    const labels = [];
    const temps = [];
    const humidities = [];
    const pressures = [];
    const rains = [];
    const snows = [];
    const winds = [];
    const windDirs = [];
    const luminosities = [];
    const uvs = [];

    dataForecast.list.forEach(item => {
      const date = new Date(item.dt * 1000);
      const label = date.toLocaleString('fr-FR', { weekday: 'short', hour: '2-digit', minute: '2-digit' });
      labels.push(label);

      temps.push(item.main.temp);
      humidities.push(item.main.humidity);
      pressures.push(item.main.pressure);
      rains.push(item.rain?.["3h"] || 0);
      snows.push(item.snow?.["3h"] || 0);
      winds.push(item.wind.speed * 3.6);
      windDirs.push(item.wind.deg);

      // Luminosit√© estim√©e corrig√©e par n√©bulosit√©
      // Base: 100% jour, 0% nuit (approximation) via heure
      const hour = date.getHours();
      const baseLum = (hour >= 7 && hour <= 19) ? 100 : 0;
      const cloudPerc = item.clouds ? item.clouds.all : 0;
      const lumCorr = baseLum * (1 - cloudPerc / 100);
      luminosities.push(lumCorr);

      // UV estim√© = (valeur UV actuel * facteur temporel simple)
      // Facteur: max √† midi (13h), 0 la nuit, lin√©aire entre 7-19h
      let uvFactor = 0;
      if(hour >= 7 && hour <= 19){
        if(hour <= 13) uvFactor = (hour - 7) / 6;
        else uvFactor = (19 - hour) / 6;
      }
      uvs.push(dataUV.value * uvFactor);
    });

    // --- Graphique principal ---
    const ctxMain = document.getElementById("mainChart").getContext("2d");
    if(window.mainChart) window.mainChart.destroy();
    window.mainChart = new Chart(ctxMain, {
      type: 'line',
      data: {
        labels,
        datasets: [
          {
            label: "Temp√©rature (¬∞C)",
            data: temps,
            borderColor: "red",
            backgroundColor: "transparent",
            yAxisID: 'y1',
            tension: 0.3,
            fill: false,
            pointRadius: 3,
          },
          {
            label: "Humidit√© (%)",
            data: humidities,
            borderColor: "blue",
            backgroundColor: "transparent",
            yAxisID: 'y2',
            tension: 0.3,
            fill: false,
            pointRadius: 3,
          },
          {
            label: "Pr√©cipitations (mm)",
            data: rains.map((r,i) => r + snows[i]),
            backgroundColor: "rgba(0,0,255,0.5)",
            type: 'bar',
            yAxisID: 'y3',
            borderRadius: 4,
          },
          {
            label: "Pression (hPa)",
            data: pressures,
            borderColor: "gray",
            borderDash: [5,5],
            fill: false,
            yAxisID: 'y4',
            tension: 0.3,
            pointRadius: 2,
          }
        ]
      },
      options: {
        responsive: true,
        interaction: { mode: 'index', intersect: false },
        stacked: false,
        scales: {
          y1: {
            type: 'linear',
            position: 'left',
            title: { display: true, text: 'Temp√©rature (¬∞C)' },
            grid: { drawOnChartArea: true },
            beginAtZero: false,
          },
          y2: {
            type: 'linear',
            position: 'right',
            offset: true,
            title: { display: true, text: 'Humidit√© (%)' },
            grid: { drawOnChartArea: false },
            beginAtZero: true,
            max: 100,
          },
          y3: {
            type: 'linear',
            position: 'right',
            offset: true,
            title: { display: true, text: 'Pr√©cipitations (mm)' },
            grid: { drawOnChartArea: false },
            beginAtZero: true,
          },
          y4: {
            type: 'linear',
            position: 'left',
            offset: true,
            title: { display: true, text: 'Pression (hPa)' },
            grid: { drawOnChartArea: false },
            beginAtZero: false,
          }
        },
        plugins: {
          legend: { position: 'top', labels: { boxWidth: 12, padding: 10 } },
          tooltip: {
            enabled: true, mode: 'nearest', intersect: false,
            callbacks: {
              label: context => {
                const label = context.dataset.label || '';
                let val = context.parsed.y;
                return label + ': ' + val;
              }
            }
          }
        }
      }
    });

    // --- Graphique secondaire (vent, UV, luminosit√© corrig√©e) ---
    const ctxWind = document.getElementById("windChart").getContext("2d");
    if(window.windChart) window.windChart.destroy();
    window.windChart = new Chart(ctxWind, {
      type: 'line',
      data: {
        labels,
        datasets: [
          {
            label: "Vitesse du vent (km/h)",
            data: winds,
            borderColor: "#1f8ef1",
            backgroundColor: "transparent",
            yAxisID: 'y1',
            tension: 0.3,
            fill: false,
            pointRadius: 3,
          },
          {
            label: "Direction du vent (¬∞)",
            data: windDirs,
            borderColor: "#555",
            borderDash: [6,4],
            yAxisID: 'y2',
            fill: false,
            tension: 0.3,
            pointRadius: 2,
          },
          {
            label: "Luminosit√© estim√©e (%)",
            data: luminosities,
            borderColor: "#f1c40f",
            backgroundColor: "transparent",
            yAxisID: 'y3',
            fill: false,
            tension: 0.3,
            pointRadius: 3,
          },
          {
            label: "Index UV estim√©",
            data: uvs,
            borderColor: "#e67e22",
            backgroundColor: "transparent",
            yAxisID: 'y4',
            fill: false,
            tension: 0.3,
            pointRadius: 3,
          }
        ]
      },
      options: {
        responsive: true,
        interaction: { mode: 'index', intersect: false },
        stacked: false,
        scales: {
          y1: {
            type: 'linear',
            position: 'left',
            title: { display: true, text: 'Vitesse vent (km/h)' },
            beginAtZero: true,
          },
          y2: {
            type: 'linear',
            position: 'right',
            offset: true,
            title: { display: true, text: 'Direction vent (¬∞)' },
            beginAtZero: false,
            min: 0,
            max: 360,
            grid: { drawOnChartArea: false },
          },
          y3: {
            type: 'linear',
            position: 'left',
            offset: true,
            title: { display: true, text: 'Luminosit√© (%)' },
            beginAtZero: true,
            max: 100,
            grid: { drawOnChartArea: false },
          },
          y4: {
            type: 'linear',
            position: 'right',
            offset: true,
            title: { display: true, text: 'Index UV' },
            beginAtZero: true,
            max: 15,
            grid: { drawOnChartArea: false },
          }
        },
        plugins: {
          legend: { position: 'top', labels: { boxWidth: 12, padding: 10 } },
          tooltip: {
            enabled: true, mode: 'nearest', intersect: false,
            callbacks: {
              label: context => {
                const label = context.dataset.label || '';
                let val = context.parsed.y;
                if(label.includes('Direction du vent')) {
                  const deg = val;
                  const card = degToCardinal(deg);
                  return `${label}: ${val}¬∞ (${card})`;
                }
                return label + ': ' + val.toFixed(1);
              }
            }
          }
        }
      }
    });

    // --- Graphique qualit√© de l'air ---
    const ctxAir = document.getElementById("airChart").getContext("2d");
    if(window.airChart) window.airChart.destroy();

    // Extraire compos√©s air pour chaque item (ici on simule la constance sur 5 jours en r√©p√©tant donn√©es actuelles)
    const pm25 = Array(labels.length).fill(dataAir.list[0].components.pm2_5);
    const pm10 = Array(labels.length).fill(dataAir.list[0].components.pm10);
    const o3 = Array(labels.length).fill(dataAir.list[0].components.o3);
    const no2 = Array(labels.length).fill(dataAir.list[0].components.no2);
    const so2 = Array(labels.length).fill(dataAir.list[0].components.so2);
    const co = Array(labels.length).fill(dataAir.list[0].components.co);

    window.airChart = new Chart(ctxAir, {
      type: 'line',
      data: {
        labels,
        datasets: [
          { label: "PM2.5 (Œºg/m¬≥)", data: pm25, borderColor: "#8e44ad", fill: false, tension: 0.3 },
          { label: "PM10 (Œºg/m¬≥)", data: pm10, borderColor: "#9b59b6", fill: false, tension: 0.3 },
          { label: "O3 (Œºg/m¬≥)", data: o3, borderColor: "#27ae60", fill: false, tension: 0.3 },
          { label: "NO2 (Œºg/m¬≥)", data: no2, borderColor: "#2980b9", fill: false, tension: 0.3 },
          { label: "SO2 (Œºg/m¬≥)", data: so2, borderColor: "#d35400", fill: false, tension: 0.3 },
          { label: "CO (Œºg/m¬≥)", data: co, borderColor: "#c0392b", fill: false, tension: 0.3 }
        ]
      },
      options: {
        responsive: true,
        interaction: { mode: 'index', intersect: false },
        stacked: false,
        scales: {
          y: {
            beginAtZero: true,
            title: { display: true, text: 'Concentration (Œºg/m¬≥)' }
          }
        },
        plugins: {
          legend: { position: 'top', labels: { boxWidth: 12, padding: 10 } },
          tooltip: {
            enabled: true, mode: 'nearest', intersect: false
          }
        }
      }
    });

  } catch(e) {
    console.error("Erreur pr√©vision ou qualit√© de l'air :", e);
  }
}

async function refreshAll() {
  await fetchWeather();
  await fetchForecastAndAir();
}

// Chargement initial
refreshAll();

// Refresh toutes les 15 minutes
setInterval(refreshAll, 900000);
  </script>
</body>
</html>
