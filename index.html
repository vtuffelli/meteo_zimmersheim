<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MÃ©tÃ©o complÃ¨te Zimmersheim - amÃ©liorÃ©e</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body, html {
      margin: 0; padding: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(to bottom, #87ceeb, #f0f8ff);
      color: #222;
      overflow-x: hidden;
    }

    #background-anim {
      position: fixed;
      top:0; left:0; right:0; bottom:0;
      z-index: -1;
      pointer-events: none;
      overflow: hidden;
    }

    .cloud {
      position: absolute;
      background: linear-gradient(to bottom, #f0f4f8, #cbd6e8);
      border-radius: 50px;
      filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));
      animation: cloudMove linear infinite;
      opacity: 0.8;
    }

    .cloud::before, .cloud::after {
      content: '';
      position: absolute;
      background: inherit;
      border-radius: 50px;
    }

    .cloud::before {
      width: 60px; height: 60px;
      top: -30px; left: 10px;
    }

    .cloud::after {
      width: 50px; height: 50px;
      top: -20px; left: 45px;
    }

    @keyframes cloudMove {
      0% { left: -150px; }
      100% { left: 110vw; }
    }

    .rain {
      position: absolute;
      width: 2px; height: 15px;
      background: rgba(0, 150, 255, 0.5);
      border-radius: 50%;
      animation: rainFall linear infinite;
    }

    @keyframes rainFall {
      0% { top: -20px; opacity: 1; }
      100% { top: 110vh; opacity: 0; }
    }

    .snow {
      position: absolute;
      width: 8px; height: 8px;
      background: white;
      border-radius: 50%;
      filter: drop-shadow(0 0 1px #aaa);
      animation: snowFall linear infinite;
    }

    @keyframes snowFall {
      0% { top: -10px; opacity: 1; transform: translateX(0); }
      100% { top: 110vh; opacity: 0; transform: translateX(20px); }
    }

    .stars {
      background: url('https://upload.wikimedia.org/wikipedia/commons/8/8e/Starry_sky_background.png');
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
      background-size: cover;
      opacity: 0.3;
      animation: pulse 20s infinite;
    }

    .moon {
      position: absolute;
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, #fff, #ccc);
      top: 40px;
      left: 80vw;
      box-shadow: 0 0 15px #fff;
      animation: float 6s ease-in-out infinite;
    }

    @keyframes float {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-10px); }
    }

    @keyframes pulse {
      0%, 100% { opacity: 0.3; }
      50% { opacity: 0.5; }
    }

    #container {
      display: flex;
      max-width: 1200px;
      margin: 30px auto;
      gap: 20px;
      flex-wrap: wrap;
    }

    #left-panel {
      flex: 1 1 350px;
      background: rgba(255,255,255,0.9);
      border-radius: 15px;
      padding: 20px;
      box-shadow: 0 0 30px rgba(0,0,0,0.1);
      user-select: none;
    }

    #right-panel {
      flex: 1 1 600px;
      border-radius: 15px;
      overflow: hidden;
      box-shadow: 0 0 30px rgba(0,0,0,0.1);
    }

    #right-panel iframe {
      width: 100%; height: 300px; border: none;
    }

    h1, h2 {
      margin-bottom: 15px; user-select: none;
      text-align: center;
    }

    .info-row {
      margin: 10px 0;
      font-size: 1.1rem;
      display: flex; align-items: center; justify-content: space-between;
    }

    .label {
      font-weight: 700;
      color: #555;
    }

    #condition-icon {
      display: block;
      margin: 10px auto;
      width: 100px; height: 100px;
    }

    section.chart-section {
      background: rgba(255,255,255,0.95);
      margin: 30px auto;
      max-width: 1200px;
      border-radius: 15px;
      padding: 20px;
      box-shadow: 0 0 30px rgba(0,0,0,0.08);
      user-select: none;
    }

    canvas {
      width: 100% !important;
      max-height: 400px !important;
    }
  </style>
</head>
<body>
  <div id="background-anim"></div>
  <div id="container">
    <div id="left-panel">
      <h1>MÃ©tÃ©o actuelle - Zimmersheim</h1>
      <img id="condition-icon" src="" alt="IcÃ´ne mÃ©tÃ©o" />
      <div class="info-row"><span class="label">Condition :</span> <span id="description"></span></div>
      <div class="info-row"><span class="label">TempÃ©rature :</span> <span id="temp"></span> Â°C</div>
      <div class="info-row"><span class="label">HumiditÃ© :</span> <span id="humidity"></span> %</div>
      <div class="info-row"><span class="label">PrÃ©cipitations (1h) :</span> <span id="precip"></span></div>
      <div class="info-row"><span class="label">Pression :</span> <span id="pressure"></span> hPa</div>
      <div class="info-row">
        <span class="label">Vent :</span>
        <span id="wind"></span> km/h
        <svg id="wind-arrow" viewBox="0 0 24 24" fill="none" stroke="#0077cc" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
          <line x1="12" y1="19" x2="12" y2="5"></line>
          <polyline points="5 12 12 5 19 12"></polyline>
        </svg>
      </div>
      <div class="info-row"><span class="label">Direction vent :</span> <span id="wind-dir"></span></div>
      <div class="info-row"><span class="label">Lever du soleil :</span> <span id="sunrise"></span></div>
      <div class="info-row"><span class="label">Coucher du soleil :</span> <span id="sunset"></span></div>
      <div class="info-row"><span class="label">LuminositÃ© estimÃ©e :</span> <span id="luminosity"></span> %</div>
      <div class="info-row"><span class="label">Phase de lune :</span> <span id="moon-phase"></span></div>
      <div class="info-row"><span class="label">QualitÃ© de l'air :</span> <span id="air-quality"></span></div>
      <div class="info-row"><span class="label">PM2.5 :</span> <span id="pm25"></span> Âµg/mÂ³</div>
      <div class="info-row"><span class="label">PM10 :</span> <span id="pm10"></span> Âµg/mÂ³</div>
      <div class="info-row"><span class="label">Oâ‚ƒ :</span> <span id="o3"></span> Âµg/mÂ³</div>
      <div class="info-row"><span class="label">NOâ‚‚ :</span> <span id="no2"></span> Âµg/mÂ³</div>
      <div class="info-row"><span class="label">SOâ‚‚ :</span> <span id="so2"></span> Âµg/mÂ³</div>
      <div class="info-row"><span class="label">CO :</span> <span id="co"></span> Âµg/mÂ³</div>
    </div>
    <div id="right-panel">

      <h2 style="text-align:center; padding: 10px 0;">Vue satellite - Zimmersheim</h2>
      <iframe
        id="map-frame"
        src="https://www.google.com/maps/embed?pb=!1m14!1m12!1m3!1d2777.8758572121094!2d7.3373!3d47.7745!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!5e0!3m2!1sfr!2sfr!4v1691246400000!5m2!1sfr!2sfr"
        allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade">
      </iframe>
    </div>
  </div>

  <section class="chart-section">
    <h2>ðŸ“Š Graphique principal</h2>
    <canvas id="mainChart"></canvas>
  </section>

  <section class="chart-section">
    <h2>ðŸ“Š Graphique secondaire (vent, luminositÃ©, UV)</h2>
    <canvas id="windChart"></canvas>
  </section>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    const apiKey = "f59e1314a26b162f41dabbc7bb2b7719";
    const city = "Zimmersheim,fr";

    async function fetchAllData() {
      try {
        const weatherRes = await fetch(`https://api.openweathermap.org/data/2.5/weather?q=${city}&units=metric&lang=fr&appid=${apiKey}`);
        const weatherData = await weatherRes.json();

        const airRes = await fetch(`https://api.openweathermap.org/data/2.5/air_pollution?lat=${weatherData.coord.lat}&lon=${weatherData.coord.lon}&appid=${apiKey}`);
        const airData = await airRes.json();

        const uvRes = await fetch(`https://api.openweathermap.org/data/2.5/uvi?appid=${apiKey}&lat=${weatherData.coord.lat}&lon=${weatherData.coord.lon}`);
        const uvData = await uvRes.json();

        const icon = weatherData.weather[0].icon;
        const condition = weatherData.weather[0].description;
        const temp = weatherData.main.temp;
        const humidity = weatherData.main.humidity;
        const pressure = weatherData.main.pressure;
        const windSpeed = weatherData.wind.speed * 3.6;
        const windDeg = weatherData.wind.deg;
        const sunrise = new Date(weatherData.sys.sunrise * 1000);
        const sunset = new Date(weatherData.sys.sunset * 1000);
        const now = new Date();

        // LuminositÃ© estimÃ©e corrigÃ©e avec nÃ©bulositÃ©
        const daylightRatio = (now > sunrise && now < sunset) ? 1 : 0;
        const cloudFactor = 1 - (weatherData.clouds.all / 100);
        const luminosity = Math.round(100 * daylightRatio * cloudFactor);
        document.getElementById("luminosity").textContent = luminosity;

        document.getElementById("condition-icon").src = `https://openweathermap.org/img/wn/${icon}@4x.png`;
        document.getElementById("description").textContent = condition;
        document.getElementById("temp").textContent = Math.round(temp);
        document.getElementById("humidity").textContent = humidity;
        document.getElementById("pressure").textContent = pressure;
        document.getElementById("wind").textContent = Math.round(windSpeed);
        document.getElementById("wind-dir").textContent = `${windDeg}Â°`;
        document.getElementById("sunrise").textContent = sunrise.toLocaleTimeString('fr-FR');
        document.getElementById("sunset").textContent = sunset.toLocaleTimeString('fr-FR');

        // Phase de lune approximative
        const moonPhase = getMoonPhase(now);
        document.getElementById("moon-phase").textContent = moonPhase;

        // QualitÃ© de l'air
        const air = airData.list[0];
        document.getElementById("air-quality").textContent = air.main.aqi + " / 5";
        document.getElementById("pm25").textContent = air.components.pm2_5;
        document.getElementById("pm10").textContent = air.components.pm10;
        document.getElementById("o3").textContent = air.components.o3;
        document.getElementById("no2").textContent = air.components.no2;
        document.getElementById("so2").textContent = air.components.so2;
        document.getElementById("co").textContent = air.components.co;

        // UV
        const uv = uvData.value || 0;

        // Graphique secondaire
        const ctx = document.getElementById("windChart").getContext("2d");
        new Chart(ctx, {
          type: 'line',
          data: {
            labels: ["Maintenant"],
            datasets: [
              {
                label: "Vent (km/h)",
                data: [windSpeed],
                borderColor: "#1f8ef1",
                tension: 0.3,
                yAxisID: 'y1'
              },
              {
                label: "LuminositÃ© (%)",
                data: [luminosity],
                borderColor: "#ffc107",
                tension: 0.3,
                yAxisID: 'y2'
              },
              {
                label: "Indice UV",
                data: [uv],
                borderColor: "#9c27b0",
                tension: 0.3,
                yAxisID: 'y3'
              }
            ]
          },
          options: {
            responsive: true,
            interaction: { mode: 'index', intersect: false },
            stacked: false,
            scales: {
              y1: {
                type: 'linear',
                position: 'left',
                title: { display: true, text: 'Vent (km/h)' },
                beginAtZero: true
              },
              y2: {
                type: 'linear',
                position: 'right',
                offset: true,
                title: { display: true, text: 'LuminositÃ© (%)' },
                beginAtZero: true,
                max: 100
              },
              y3: {
                type: 'linear',
                position: 'right',
                offset: true,
                title: { display: true, text: 'Indice UV' },
                min: 0,
                max: 11,
                grid: { drawOnChartArea: false }
              }
            }
          }
        });

        // Animation fond
        const bg = document.getElementById("background-anim");
        bg.innerHTML = '';
        if (daylightRatio === 0) {
          const stars = document.createElement('div');
          stars.className = 'stars';
          bg.appendChild(stars);

          const moon = document.createElement('div');
          moon.className = 'moon';
          bg.appendChild(moon);
        }

      } catch (e) {
        console.error("Erreur mÃ©tÃ©o :", e);
      }
    }

    // Moon phase calcul simple
    function getMoonPhase(date) {
      const lp = 2551443;
      const now = date.getTime() / 1000;
      const new_moon = new Date(2001, 0, 24, 13, 35, 0).getTime() / 1000;
      const phase = ((now - new_moon) % lp) / lp;
      if (phase < 0.03 || phase > 0.97) return "Nouvelle lune ðŸŒ‘";
      else if (phase < 0.22) return "Premier croissant ðŸŒ’";
      else if (phase < 0.28) return "Premier quartier ðŸŒ“";
      else if (phase < 0.47) return "Lune gibbeuse croissante ðŸŒ”";
      else if (phase < 0.53) return "Pleine lune ðŸŒ•";
      else if (phase < 0.72) return "Gibbeuse dÃ©croissante ðŸŒ–";
      else if (phase < 0.78) return "Dernier quartier ðŸŒ—";
      else return "Dernier croissant ðŸŒ˜";
    }

    fetchAllData();
  </script>
</body>
</html>
      
