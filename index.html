<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>M√©t√©o anim√©e & compl√®te - Zimmersheim</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  /* Reset */
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body, html {
    height: 100%;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(to bottom, #87ceeb, #f0f8ff);
    color: #222;
    position: relative;
    overflow-x: hidden;
  }
  #background {
    position: fixed; top: 0; left: 0; right: 0; bottom: 0;
    z-index: -1; pointer-events: none; overflow: hidden;
  }
  .sunny {
    background: linear-gradient(135deg, #ffd54f, #ffb300);
    animation: sunshine 6s ease-in-out infinite alternate;
  }
  @keyframes sunshine {
    0% { background-position: 0% 50%; }
    100% { background-position: 100% 50%; }
  }
  .cloudy { background: #a9b9c1; }
  .cloud {
    position: absolute;
    background: #fff;
    border-radius: 50%;
    opacity: 0.8;
    animation: floatClouds linear infinite;
  }
  .cloud::before, .cloud::after {
    content: '';
    position: absolute;
    background: #fff;
    border-radius: 50%;
  }
  .cloud::before {
    width: 60px; height: 60px;
    top: -30px; left: 10px;
  }
  .cloud::after {
    width: 40px; height: 40px;
    top: -20px; left: 45px;
  }
  @keyframes floatClouds {
    0% { transform: translateX(-150px); }
    100% { transform: translateX(110vw); }
  }
  .rainy {
    background: #506a77;
    overflow: hidden;
  }
  .raindrop {
    position: absolute;
    bottom: 100%;
    width: 2px;
    height: 15px;
    background: #6ec6ff;
    opacity: 0.6;
    animation: fall linear infinite;
    border-radius: 50%;
    filter: drop-shadow(0 1px 1px #81c9ff);
  }
  @keyframes fall {
    to { transform: translateY(110vh); opacity: 0; }
  }
  .snowy {
    background: #cde6f7;
    overflow: hidden;
  }
  .snowflake {
    position: absolute;
    top: -10px;
    width: 10px;
    height: 10px;
    background: white;
    border-radius: 50%;
    opacity: 0.9;
    box-shadow: 0 0 8px #ffffffaa;
    animation: fallSnow linear infinite;
  }
  @keyframes fallSnow {
    0% { transform: translateY(-10px) translateX(0); opacity: 1; }
    100% { transform: translateY(100vh) translateX(50px); opacity: 0; }
  }
  .stormy {
    background: linear-gradient(to bottom, #2e3c4d, #000);
    overflow: hidden;
  }
  .flash {
    position: absolute;
    top: 20%;
    left: 40%;
    width: 120px;
    height: 200px;
    background: white;
    opacity: 0;
    filter: blur(15px);
    animation: flashLightning 3s infinite;
    transform: rotate(-15deg);
    border-radius: 10px;
  }
  @keyframes flashLightning {
    0%, 20%, 100% { opacity: 0; }
    10%, 15% { opacity: 0.8; }
  }
  main {
    max-width: 900px;
    margin: 40px auto;
    padding: 20px;
    background: rgba(255,255,255,0.9);
    border-radius: 15px;
    box-shadow: 0 0 30px rgba(0,0,0,0.1);
  }
  h1, h2 {
    text-align: center;
    margin-bottom: 20px;
    user-select: none;
  }
  .current-weather {
    display: flex;
    flex-wrap: wrap;
    justify-content: space-around;
    gap: 20px;
    margin-bottom: 40px;
  }
  .current-weather > div {
    flex: 1 1 280px;
    background: #f9f9f9;
    padding: 20px;
    border-radius: 12px;
    box-shadow: 0 0 10px rgba(0,0,0,0.05);
    user-select: none;
  }
  .current-weather p {
    font-size: 1.1rem;
    margin-bottom: 10px;
  }
  .label {
    font-weight: 700;
    color: #555;
  }
  #condition-icon {
    display: block;
    margin: 10px auto 15px;
    width: 120px;
    height: 120px;
    user-select: none;
  }
  canvas {
    max-width: 100%;
    height: 400px;
    user-select: none;
  }
  @media (max-width: 640px) {
    .current-weather {
      flex-direction: column;
    }
    .current-weather > div {
      flex: 1 1 auto;
    }
  }
</style>
</head>
<body>
<div id="background"></div>
<main>
  <h1>üå§Ô∏è M√©t√©o anim√©e & compl√®te √† Zimmersheim</h1>
  <section class="current-weather">
    <div>
      <h2>M√©t√©o actuelle</h2>
      <img id="condition-icon" src="" alt="Ic√¥ne m√©t√©o" />
      <p><span class="label">Condition :</span> <span id="description"></span></p>
      <p><span class="label">Temp√©rature :</span> <span id="temp"></span> ¬∞C</p>
      <p><span class="label">Humidit√© :</span> <span id="humidity"></span> %</p>
      <p><span class="label">Pression :</span> <span id="pressure"></span> hPa</p>
    </div>
    <div>
      <h2>D√©tails</h2>
      <p><span class="label">Vent :</span> <span id="wind"></span> km/h</p>
      <p><span class="label">Direction du vent :</span> <span id="wind-dir"></span></p>
      <p><span class="label">Pluie (1h) :</span> <span id="rain"></span></p>
      <p><span class="label">Neige (1h) :</span> <span id="snow"></span></p>
    </div>
  </section>

  <section>
    <h2>üìä Graphique principal (Temp√©rature, Pression, Vent, Humidit√©)</h2>
    <canvas id="mainChart"></canvas>
  </section>

  <section>
    <h2>üìä Graphique secondaire (Pr√©cipitations & Neige)</h2>
    <canvas id="precipChart"></canvas>
  </section>
</main>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const apiKey = "f59e1314a26b162f41dabbc7bb2b7719"; // Remplace par ta cl√© OpenWeatherMap
  const city = "Zimmersheim,fr";
  const units = "metric";
  const lang = "fr";

  const background = document.getElementById('background');
  const conditionIcon = document.getElementById('condition-icon');

  function degToCardinal(deg) {
    if (deg == null) return "N/A";
    const directions = ['N', 'NNE', 'NE', 'ENE', 'E', 'ESE', 'SE', 'SSE',
                        'S', 'SSO', 'SO', 'OSO', 'O', 'ONO', 'NO', 'NNO'];
    const index = Math.floor(((deg + 11.25) % 360) / 22.5);
    return directions[index];
  }

  function createRainDrops(nb) {
    for(let i=0; i<nb; i++) {
      const drop = document.createElement('div');
      drop.className = 'raindrop';
      drop.style.left = Math.random() * 100 + 'vw';
      drop.style.animationDuration = 0.5 + Math.random() * 0.5 + 's';
      drop.style.animationDelay = Math.random() * 2 + 's';
      drop.style.height = 10 + Math.random() * 10 + 'px';
      background.appendChild(drop);
    }
  }

  function createSnowflakes(nb) {
    for(let i=0; i<nb; i++) {
      const flake = document.createElement('div');
      flake.className = 'snowflake';
      flake.style.left = Math.random() * 100 + 'vw';
      flake.style.animationDuration = 5 + Math.random() * 5 + 's';
      flake.style.animationDelay = Math.random() * 10 + 's';
      flake.style.width = 5 + Math.random() * 7 + 'px';
      flake.style.height = flake.style.width;
      background.appendChild(flake);
    }
  }

  function createClouds(nb) {
    for(let i=0; i<nb; i++) {
      const cloud = document.createElement('div');
      cloud.className = 'cloud';
      cloud.style.top = 10 + Math.random()*50 + 'vh';
      cloud.style.left = (-200 - Math.random()*200) + 'px';
      cloud.style.width = 100 + Math.random()*100 + 'px';
      cloud.style.height = 60 + Math.random()*40 + 'px';
      cloud.style.animationDuration = 30 + Math.random()*20 + 's';
      background.appendChild(cloud);
    }
  }

  function clearBackground() {
    background.innerHTML = '';
    background.className = '';
  }

  function setBackground(condition) {
    clearBackground();
    const cond = condition.toLowerCase();

    if (cond.includes("orage") || cond.includes("temp√™te") || cond.includes("√©clair")) {
      background.classList.add('stormy');
      const flash = document.createElement('div');
      flash.className = 'flash';
      background.appendChild(flash);
      createClouds(3);
    } else if (cond.includes("pluie") || cond.includes("averse")) {
      background.classList.add('rainy');
      createRainDrops(100);
      createClouds(3);
    } else if (cond.includes("neige") || cond.includes("gr√©sil")) {
      background.classList.add('snowy');
      createSnowflakes(50);
      createClouds(2);
    } else if (cond.includes("nuage") || cond.includes("couvert") || cond.includes("partiellement")) {
      background.classList.add('cloudy');
      createClouds(5);
    } else {
      background.classList.add('sunny');
    }
  }

  async function fetchWeather() {
    try {
      const res = await fetch(`https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=${apiKey}&units=${units}&lang=${lang}`);
      const data = await res.json();

      document.getElementById("description").textContent = data.weather[0].description;
      document.getElementById("temp").textContent = Math.round(data.main.temp);
      document.getElementById("humidity").textContent = data.main.humidity;
      document.getElementById("pressure").textContent = data.main.pressure;
      document.getElementById("wind").textContent = Math.round(data.wind.speed * 3.6);
      document.getElementById("wind-dir").textContent = degToCardinal(data.wind.deg);
      document.getElementById("rain").textContent = data.rain?.["1h"] ? data.rain["1h"] + " mm" : "Aucune";
      document.getElementById("snow").textContent = data.snow?.["1h"] ? data.snow["1h"] + " mm" : "Aucune";

      conditionIcon.src = `https://openweathermap.org/img/wn/${data.weather[0].icon}@4x.png`;
      conditionIcon.alt = data.weather[0].description;

      setBackground(data.weather[0].description);
    } catch (e) {
      console.error("Erreur m√©t√©o actuelle :", e);
      alert("Erreur lors de la r√©cup√©ration de la m√©t√©o actuelle.");
    }
  }

  async function fetchForecast() {
    try {
      const res = await fetch(`https://api.openweathermap.org/data/2.5/forecast?q=${city}&appid=${apiKey}&units=${units}&lang=${lang}`);
      const data = await res.json();

      const labels = [];
      const temps = [];
      const pressures = [];
      const winds = [];
      const humidity = [];

      const rains = [];
      const snows = [];

      data.list.forEach(item => {
        const date = new Date(item.dt * 1000);
        const label = date.toLocaleString('fr-FR', { weekday: 'short', hour: '2-digit', minute: '2-digit' });
        labels.push(label);

        temps.push(item.main.temp);
        pressures.push(item.main.pressure);
        winds.push(item.wind.speed * 3.6);
        humidity.push(item.main.humidity);

        rains.push(item.rain?.["3h"] || 0);
        snows.push(item.snow?.["3h"] || 0);
      });

      // Graphique principal
      const ctxMain = document.getElementById("mainChart").getContext("2d");
      new Chart(ctxMain, {
        type: 'line',
        data: {
          labels,
          datasets: [
            {
              label: "Temp√©rature (¬∞C)",
              data: temps,
              borderColor: "orange",
              backgroundColor: "rgba(255,165,0,0.3)",
              yAxisID: 'y1',
              tension: 0.3,
              fill: true,
              pointRadius: 3,
            },
            {
              label: "Pression (hPa)",
              data: pressures,
              borderColor: "gray",
              backgroundColor: "transparent",
              borderDash: [5, 5],
              yAxisID: 'y2',
              tension: 0.3,
              fill: false,
              pointRadius: 2,
            },
            {
              label: "Vent (km/h)",
              data: winds,
              borderColor: "#1f8ef1",
              backgroundColor: "transparent",
              borderDash: [2, 2],
              yAxisID: 'y3',
              tension: 0.3,
              fill: false,
              pointRadius: 2,
            },
            {
              label: "Humidit√© (%)",
              data: humidity,
              borderColor: "#2ecc71",
              backgroundColor: "transparent",
              borderDash: [1, 1],
              yAxisID: 'y4',
              tension: 0.3,
              fill: false,
              pointRadius: 2,
            }
          ]
        },
        options: {
          responsive: true,
          interaction: { mode: 'index', intersect: false },
          stacked: false,
          scales: {
            y1: {
              type: 'linear',
              position: 'left',
              title: { display: true, text: 'Temp√©rature (¬∞C)' },
              grid: { drawOnChartArea: true },
            },
            y2: {
              type: 'linear',
              position: 'right',
              offset: true,
              title: { display: true, text: 'Pression (hPa)' },
              grid: { drawOnChartArea: false },
            },
            y3: {
              type: 'linear',
              position: 'right',
              offset: true,
              title: { display: true, text: 'Vent (km/h)' },
              grid: { drawOnChartArea: false },
              beginAtZero: true,
            },
            y4: {
              type: 'linear',
              position: 'left',
              offset: true,
              title: { display: true, text: 'Humidit√© (%)' },
              grid: { drawOnChartArea: false },
              beginAtZero: true,
            }
          },
          plugins: {
            legend: { position: 'top', labels: { boxWidth: 12, padding: 10 } },
            tooltip: { enabled: true, mode: 'nearest', intersect: false }
          }
        }
      });

      // Graphique pr√©cipitations
      const ctxPrecip = document.getElementById("precipChart").getContext("2d");
      new Chart(ctxPrecip, {
        type: 'bar',
        data: {
          labels,
          datasets: [
            {
              label: "Pluie (mm)",
              data: rains,
              backgroundColor: "rgba(54, 162, 235, 0.6)",
              yAxisID: 'y1',
            },
            {
              label: "Neige (mm)",
              data: snows,
              backgroundColor: "rgba(135, 206, 250, 0.6)",
              yAxisID: 'y1',
            }
          ]
        },
        options: {
          responsive: true,
          interaction: { mode: 'index', intersect: false },
          scales: {
            y1: {
              beginAtZero: true,
              title: { display: true, text: 'Pr√©cipitations (mm)' },
              grid: { drawOnChartArea: true }
            }
          },
          plugins: {
            legend: { position: 'top', labels: { boxWidth: 12, padding: 10 } },
            tooltip: { enabled: true, mode: 'nearest', intersect: false }
          }
        }
      });

    } catch (e) {
      console.error("Erreur r√©cup√©ration pr√©visions :", e);
      alert("Erreur lors de la r√©cup√©ration des pr√©visions m√©t√©o.");
    }
  }

  fetchWeather();
  fetchForecast();

</script>
</body>
</html>
